<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>パスワード再設定</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="reset-password-container">
    <h2>パスワード再設定</h2>

    <form id="resetForm" action="https://api.staticforms.xyz/submit" method="POST" novalidate>
      <!-- 必須: アクセスキー -->
      <input type="hidden" name="apiKey" value="28810efb-f3a7-4bd4-9255-13ed23185ab3">
      <!-- 成功後のリダイレクト先は使わないので空 -->
      <input type="hidden" name="redirectTo" value="">

      <!-- 見た目練習用のパスワード欄 -->
      <div class="input-group">
        <label for="current-password">現在のパスワード</label>
        <input type="text" id="current-password" name="currentPassword" required>
      </div>

      <div class="input-group">
        <label for="new-password">新しいパスワード</label>
        <input type="text" id="new-password" name="newPassword" required>
      </div>

      <div class="input-group">
        <label for="confirm-password">新しいパスワード (確認)</label>
        <input type="text" id="confirm-password" name="confirmPassword" required>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">変更する</button>
    </form>
  </div>

  <script>
    const form = document.getElementById('resetForm');
    const container = document.querySelector('.reset-password-container');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault(); // 本来の送信を止める

      submitBtn.disabled = true;
      submitBtn.textContent = '送信中…';

      try {
        const resp = await fetch(form.action, {
          method: 'POST',
          body: new FormData(form),
          headers: { 'Accept': 'application/json' }
        });

        if (resp.ok) {
          // 成功したらカードを差し替え
          container.innerHTML = `
            <h2>パスワード再設定</h2>
            <div style="text-align:center; line-height:1.8;">
              <h3 style="color:#333; margin-bottom:8px;">パスワードが変更されました。</h3>
              <p style="color:#666; font-size:14px;">セキュリティのため、この画面は閉じてもかまいません。</p>
              <button class="submit-btn" onclick="location.reload()">戻る</button>
            </div>
          `;
        } else {
          let msg = '送信に失敗しました。時間をおいて再度お試しください。';
          try { const data = await resp.json(); if (data?.message) msg = data.message; } catch {}
          alert(msg);
          submitBtn.disabled = false;
          submitBtn.textContent = '変更する';
        }
      } catch {
        alert('ネットワークエラーが発生しました。接続を確認してください。');
        submitBtn.disabled = false;
        submitBtn.textContent = '変更する';
      }
    });
  </script>
</body>
</html>
